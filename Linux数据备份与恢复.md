# Linux数据备份与恢复
---
&emsp;&emsp;在虚拟机中使用Linux ，可以使用快照功能，保存某一时间点的系统数据备份，恢复快照时直接恢复到保存时间点状态，但对保存快照以后的操作不会进行恢复（VMware Workstation Pro版本具有快照功能，普通版本没有）。实体机没有快照功能，如果系统出现异常或者数据损坏，后果严重，要重做系统，还会造成数据丢失，所以我们可以使用备份和恢复技术，Linux的备份和恢复有两种方式：  
&emsp;&emsp;1. 把需要的文件（或者分区）用tar打包，下次需要恢复的时候再解压覆盖  
&emsp;&emsp;2. 使用`dump`和`restore`命令（如果Linux上没有dump和restore指令，需要先使用`yum -y install dump`和`yum -y intsall restore`进行安装）
## 1. 使用dump完成备份
+ 基本介绍
  dump支持分卷和增量备份（所谓增量备份是指备份上次备份后修改/增加过的文件，也称差异备份）
+ 语法说明
  `dump [-123456789][-cuj] [-f <备份后的文件名>] [-T <日期>] [目录或系统文件]`  
  `dump [-w/W]`
+ 参数说明
  | 参数                  | 说明                                                                                                                      |
  | --------------------- | ------------------------------------------------------------------------------------------------------------------------- |
  | *-c*                  | 创建新的归档文件，并将由一个或多个文件参数所指定的内容写入归档文件的开头                                                  |
  | *-0123456789*         | 备份的层级，0为最完整备份，会被备份所有文件。若指定0以上的级别，则备份至上一次备份以来修改或新增的文件，到9后可以再次轮替 |
  | *-f <备份后的文件名>* | 指定备份后的文件名                                                                                                        |
  | *-j*                  | 调用**bzlib**库压缩备份文件，也就是将备份后的文件压缩成*bz2*格式，让文件更小                                              |
  | *-T <日期>*           | 指定开始备份的时间与日期                                                                                                  |
  | *-u*                  | 备份完毕后，在 */etc/dumpdares* 中记录内分的文件系统、层级、日期与时间等                                                  |
  | *-t*                  | 指定文件名，若该文件已存在备份文件中，则列出名称                                                                          |
  | *-W*                  | 显示需要备份的文件以及最后一次备份的层级、时间、日期                                                                      |
  | *-w*                  | 与 *-W* 类似，但仅显示需要备份的文件                                                                                      |
+ 注意事项
  在备份分区时，是可以支持增量备份的，如果备份文件或者目录，不再支持增量备份，即只能使用0级别备份。如果是重要文件的备份，比如数据区，建议将文件上传到其他服务器保存，不要把鸡蛋放在同一个篮子里
---
## 2. 使用restore完成恢复
+ 基本介绍
  restore命令用来恢复已备份的文件，可以从dump生成的备份文件中恢复原文件
+ 基本语法
  `restore [模式选项] [选项]`
+ 模式说明
  下面四种模式不能混用，在一次命令中只能指定一中
  | 模式 | 说明                                                      |
  | ---- | --------------------------------------------------------- |
  | *-C* | 使用对比模式，将备份的文件与已存在的文件相互对比          |
  | *-i* | 使用交互模式，在进行还原操作时，restore指令将依次询问用户 |
  | *-r* | 进行还原模式                                              |
  | *-t* | 查看模式，查看备份文件有哪些文件                          |
+ 常用选项
  *-f <备份设备>*：从指定的文件中读取备份数据，进行还原操作