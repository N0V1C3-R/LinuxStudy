# Shell编程入门
---
## 1. Shell编程的应用
1. Linux运维工程师在进行服务器集群管理的时候，需要编写Shell程序来进行服务器管理  
2. 对于JavaEE和Python程序员来说，往往需要编写一些Shell脚本进行程序或服务器的维护，比如编写一个定时备份数据库的脚本等  
3. 对于大数据程序员来说，需要编写Shell程序来管理集群  
---
## 2. Shell是什么？  
Shell是一个命令行解释器，它为用户提供了一个向Linux内核发送请求以便运行程序的界面系统级程序，用户可以用Shell来启动、挂起、停止甚至编写一些程序  
---
## 3. Shell脚本的执行方式  
+ 脚本格式要求  
  1. 脚本以`#!/bin/bash`开头  
  2. 脚本需要有可执行的权限
+ 编写第一个Shell脚本  
  `mkdir /root/shcode` ==> `cd /root/shcode` ==> `vim hello.sh`
  ```Shell
  #!bin/bash
  echo "hello, world~"
  ```
+ 脚本常用的执行方式  
  1. 输入脚本的绝对路径或在脚本所在目录下输入相对路径  
   说明：首先要赋予 *filename.sh* 脚本的 *+x* 权限再执行脚本（`chmod u+x hello.sh`、`./hello.sh`）  
  2. `sh filename.sh`  
   说明：不需要添加执行权限，可直接执行（`chmod u-x hello.sh`、`sh hello.sh`）
---
## 4. Shell变量
+ Shell变量介绍
  1. Linux Shell中的变量分为：系统变量和用户自定义变量  
  2. 系统变量：$HOME、$PWD、$SHELL、$USER等等
  3. 显示当前Shell中所有变量`set`
+ Shell变量的定义
  1. 定义变量：`变量名 = 值`  
  2. 撤销变量：`unset 变量`  
  3. 声明静态变量：`readonly 变量`（注意：不能撤销）
+ 举例  
  ```Shell
  #!/bin/bash
  #案例一：定义变量A
  A=100
  #输出变量需要加上$
  echo $A #输出100
  echo A=$A #输出A=100
  echo "A=$A" #输出A=100
  #案例二：撤销变量A
  unset A
  echo "A=$A" #没有输出
  #案例三：声明静态变量B=2
  readonly B=2
  echo "B=$B" #输出B=2
  unset B #执行时报错
  ```
+ Shell变量的定义
  + 变量定义的规则
    1. 变量名称可以由字母、数字和下划线组成，但是不能以数字开头  
    2. 定义变量时等号两侧不能有空格  
    3. 变量名称一般习惯为大写  
  + 将命令的返回值赋给变量
    1. 变量名=\`命令\`&emsp;使用反引号  
    2. 变量名=$(命令)&emsp;等价于反引号
---
## 5. 设置环境变量
+ 什么是环境变量？  
  一般是指在操作系统中用来指定操作系统运行环境的一些参数，如：临时文件夹位置和系统文件夹位置等。环境变量是在操作系统中一个具有特定名字的对象，它包含了一个或者多个应用程序所将使用到的信息。例如Windows和DOS操作系统中的path环境变量，当要求系统运行一个程序而没有告诉它程序所在的完整路径时，系统除了在当前目录下面寻找此程序外，还应到path中指定的路径去找。用户通过设置环境变量，来更好的运行进程。
+ 基本语法
  `export 变量名=变量值`&emsp;将Shell变量输出为环境变量  
  `source 配置文件`&emsp;让修改后的配置信息立即生效  
  `echo $变量名`&emsp;查询环境变量的值  
  注意：在使用新的环境前，需要使用source命令使文件生效
+ Shell脚本的多行注释  
  ```Shell
  :<<! 
  内容
  !
  ```
---
## 6. 位置参数变量
+ 基本介绍
  当我们执行一个Shell脚本时，如果希望获取到命令行的参数信息，就可以使用到位置参数变量
+ 基本语法
  `$n`&emsp;n为数字，$0代表命令本身，$1-$9代表第一到第九个参数，是以上的参数需要用大括号包含，如${10}  
  `$*`&emsp;这个变量代表命令行中所有的参数，$*把所有的参数看成一个整体  
  `$@`&emsp;这个变量也代表命令行中所有的参数，不过$@把每个参数区分对待  
  `$#`&emsp;这个变量代表命令行中参数的个数  
+ 举例
  输入命令：  
  `vim myshell.sh`  
  编写Shell脚本：  
  ```Shell
  #!/bin/bash
  echo "0=$0 1=$1 2=$2"
  echo "所有的参数$*"
  echo "$@"
  echo "参数的个数=$#"
  ```
  执行脚本：  
  `chmod u+x myshell.sh`  
  `./myshell.sh 100 200`  
  执行结果：    
  ```
  0=./myshell.sh 1=100 2=200
  所有的参数=100 200
  100 200
  参数的个数=2
  ```
---
## 7. 预定义变量
+ 基本介绍
  Shell设计者事先已经定义好的变量，可以直接在Shell脚本中使用
+ 基本语法  
  `$$`&emsp;当前进程的进程号（PID）  
  `$!`&emsp;后台运行的最后一个进程的进程号（PID）  
  `$?`&emsp;最后一次至此那个的命令的返回状态。如果这个变量的值为0，证明上一个命令正确执行，如果这个变量的值为非0（具体的数由命令自己决定），则证明上一个命令执行不正确  
+ 举例  
  输入命令：  
  `vim preVAr.sh`  
  编写Shell脚本：  
  ```Shell
  #!/bin/bash
  echo "当前执行的进程id=$$"
  #以后台的方式运行一个脚本，并获取它的进程号
  /root/shcode/myshell.sh &
  echo "最后一个以后台方式运行的进程id=$!"
  echo "执行的结果=$?"
  ```
  执行脚本：  
  `chmod u+x preVar.sh`  
  `./preVar.sh`  
  执行结果：  
  ```
  当前执行的进程id=16392
  最后一个以后台方式运行的进程id=16393
  执行的结果=0
  [root@N2M]# 0=/root/shcode/myshell.sh 1= 2=
  所有的参数=

  参数的个数=0

  ```
  注意：前三行当前脚本执行结果，后面的结果为当前脚本内执行的脚本的信息，但信息输出不完整，直接`Ctrl` + `c`退出即可  
---
## 8. 运算符
+ 基本介绍
  在Shell脚本中进行运算
+ 基本语法
  1. `"$((运算式))"`或`$[运算式]`或`expr m 运算符 n`  
  2. 注意expr运算符之间要有空格，如果希望将expr的结果赋给某个变量，使用``  
  3. 在expr中使用运算符：`+`加、`-`减、`\*`乘、`/`除、`%`取余（**特别注意乘**）
+ 举例  
  输入命令：  
  `vim oper.sh`  
  编写Shell脚本：  
  ```Shell
  #!/bin/bash
  #案例一：计算(2+3)*4的值
  #方法一
  RES1=$(((2+3)*4))
  echo "res1=$RES1"
  #方法二（推荐使用）
  RES2=$[(2+3)*4]
  echo "res2=$RES2"
  #方法三
  TEMP=`expr 2 + 3`
  RES3=`expr TEMP \* 4`
  echo "res3=$RES3"

  #案例二：请求出命令行的两个参数[整数]的和20 50
  SUM=$[$1+$2]
  echo "sum=$SUM"
  ```
  执行脚本：  
  `chmod u+x oper.sh`  
  `./oper.sh 20 50`  
  执行结果：  
  ```
  res1=20
  res2=20
  res3=20
  sum=70
  ```